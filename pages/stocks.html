<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!--Import Google Icon Font-->
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />

    <!-- Compiled and minified CSS -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css"
    />

    <title>Materialize Example</title>
    <style></style>
  </head>
  <body>
    <div class="container">
      Apple Inc.
      <div class="stock-name"></div>
      <div class="time"></div>
    </div>
    <div class="container">
      <p>hello</p>
    </div>
    <div class="container">
      Apple Inc.
      <div id="AAPL" class="stock-name"></div>
      <div class="time"></div>
    </div>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

    <script>
      var intervalTime = 60;

      document.addEventListener("DOMContentLoaded", () => {
        // https://financialmodelingprep.com/developer/docs

        getRequest(
          "https://financialmodelingprep.com/api/v3/quote-short/AAPL?apikey=demo",
          drawOutput
        );

        setInterval(() => {
          getRequest(
            "https://financialmodelingprep.com/api/v3/quote-short/AAPL?apikey=demo",
            drawOutput
          );
        }, 1000 * intervalTime);

        function drawOutput(responseText) {
          let resp = JSON.parse(responseText);

          var elements = document.querySelectorAll(".stock-name")[0];

          elements.innerHTML = "$ " + resp[0].price;

          var time = document.querySelectorAll(".time")[0];
          var usaTime = new Date().toLocaleString("en-US", {
            timeZone: "America/New_York",
          });
          usaTime = new Date(usaTime);
          time.innerHTML = usaTime;
        }

        function getRequest(url, success) {
          var req = false;
          try {
            req = new XMLHttpRequest();
          } catch (e) {
            try {
              req = new ActiveXObject("Msxml2.XMLHTTP");
            } catch (e) {
              try {
                req = new ActiveXObject("Microsoft.XMLHTTP");
              } catch (e) {
                return false;
              }
            }
          }
          if (!req) return false;
          if (typeof success != "function") success = function () {};
          req.onreadystatechange = function () {
            if (req.readyState == 4) {
              if (req.status === 200) {
                success(req.responseText);
              }
            }
          };
          req.open("GET", url, true);
          req.send(null);
          return req;
        }
      });
    </script>
  </body>
</html>
